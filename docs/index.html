<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>&lt;3</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: '8bit';
            src: url('fonts/8bit.ttf') format('truetype');
        }

        #custom-title-bar {
            -webkit-app-region: drag;
            height: 35px;
            background-color: #ff9aab;
            color: rgb(255, 220, 220);
            font-size: 1.5em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            font-family: '8bit', cursive;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 9999;
        }

        #window-controls {
            display: flex;
            -webkit-app-region: no-drag;
        }

        #window-controls button {
            background: transparent;
            border: none;
            padding: 5px;
            margin-right: 10px;
            cursor: pointer;
        }

        #window-controls button img {
            width: 20px;
            height: 20px;
            filter: brightness(0) invert(1); /* agar warna putih di atas pink */
        }

        #window-controls button:hover img {
            filter: brightness(0.9) invert(1) drop-shadow(0 0 2px white);
        }

        body {
            padding-top: 35px; /* Untuk topbar */
            margin: 0;
            padding: 0;
            background: url('cute.gif') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: '8bit', cursive;
            color: white;
            text-shadow: 2px 2px 4px #000;
        }
        #lyrics {
            font-size: 2.8em;
            text-align: center;
            background: rgb(225 145 145 / 50%);
            padding: 30px;
            border-radius: 15px;
            min-width: 80%;
            min-height: 100px;
        }
        .cursor {
            display: inline-block;
            width: 15px;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="custom-title-bar">
        <div class="title">Kamu Cantik, Kamu Baik! &lt;3</div>
        <div id="window-controls">
            <button id="home-btn"><img src="assets/home.png"></button>
            <button id="max-btn"><img src="assets/maximize.png"></button>
            <button id="close-btn"><img src="assets/close.png"></button>
        </div>
    </div>

    <div id="lyrics"><span id="text"></span><span class="cursor">|</span></div>

    <audio id="bg-music" src="assets/kamu-cantik.mp3" autoplay loop></audio>

    <script>
        document.getElementById('home-btn').addEventListener('click', () => {
            location.reload();
        });
        document.getElementById('max-btn').addEventListener('click', () => {
            window.electronAPI.sendWindowControl('maximize');
        });
        document.getElementById('close-btn').addEventListener('click', () => {
            window.electronAPI.sendWindowControl('close');
        });

        // Lirik dan timestamp (detik) kapan lirik muncul
        const lyrics = [
            { time: 0.0, text: "Karena kamu cantik" },
            { time: 3.5, text: "Kan ku beri segalanya apa yang ku punya" },
            { time: 8.0, text: "Dan hatimu baik" },
            { time: 11.0, text: "Sempurnalah duniaku saat kau disisiku" },
            { time: 35.0, text: "Bukan karena make up di wajahmu" },
            { time: 39.5, text: "Atau lipstik merah itu" },
            { time: 43.0, text: "Lembut hati tutur kata" },
            { time: 47.0, text: "Terciptalah cinta yang ku puja" },
            { time: 51.0, text: "Tak peduli langit menertawakanku" },
            { time: 55.5, text: "Kau mencuri hatiku mimpiku semua rinduku" },
            { time: 60.0, text: "Karna kamu cantik" },
            { time: 63.5, text: "Kan ku beri segalanya apa yang ku punya" },
            { time: 68.0, text: "Dan hatimu baik" },
            { time: 71.0, text: "Sempurnalah duniaku saat kau disisiku" },
            { time: 75.0, text: "<3" }
        ];

        const display = document.getElementById('text');
        const audio = document.getElementById('bg-music');
        let currentLyric = -1;


        let typewriterTimeout = null;
        function typeLyric(text, i = 0) {
            if (typewriterTimeout) clearTimeout(typewriterTimeout);
            if (i <= text.length) {
                display.textContent = text.slice(0, i);
                typewriterTimeout = setTimeout(() => typeLyric(text, i + 1), 40);
            }
        }

        function updateLyric() {
            if (!audio || !lyrics.length) return;
            const t = audio.currentTime;
            let idx = lyrics.length - 1;
            for (let i = 0; i < lyrics.length; i++) {
                if (t < lyrics[i].time) {
                    idx = i - 1;
                    break;
                }
            }
            if (idx !== currentLyric && idx >= 0) {
                typeLyric(lyrics[idx].text);
                currentLyric = idx;
            } else if (idx < 0) {
                display.textContent = '';
                currentLyric = -1;
            }
        }

        audio.addEventListener('timeupdate', updateLyric);
        audio.addEventListener('seeked', updateLyric);
        audio.addEventListener('play', updateLyric);
        audio.addEventListener('ended', function() {
            display.textContent = '<3';
            currentLyric = -1;
        });
        // Inisialisasi lirik saat audio siap
        audio.addEventListener('loadedmetadata', updateLyric);
        // Autoplay workaround untuk browser yang membatasi autoplay
        function playMusicOnce() {
            if (audio) {
                audio.play();
            }
            window.removeEventListener('click', playMusicOnce);
            window.removeEventListener('touchstart', playMusicOnce);
        }
        window.addEventListener('click', playMusicOnce);
        window.addEventListener('touchstart', playMusicOnce);
    </script>
</body>
</html>